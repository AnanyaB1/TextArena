<!DOCTYPE html>

<html lang="en" data-content_root="../../../../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>textarena.envs.single_player.Sudoku.env &#8212; TextArena 1.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../../../_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="../../../../../_static/basic.css?v=686e5160" />
    <link rel="stylesheet" type="text/css" href="../../../../../_static/alabaster.css?v=27fed22d" />
    <script src="../../../../../_static/documentation_options.js?v=8d563738"></script>
    <script src="../../../../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../../search.html" />
   
  <link rel="stylesheet" href="../../../../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for textarena.envs.single_player.Sudoku.env</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">List</span>
<span class="kn">import</span> <span class="nn">random</span><span class="o">,</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">textarena</span> <span class="k">as</span> <span class="nn">ta</span>
<span class="kn">import</span> <span class="nn">time</span>

<div class="viewcode-block" id="SudokuEnv">
<a class="viewcode-back" href="../../../../../source/textarena.envs.single_player.Sudoku.html#textarena.envs.single_player.Sudoku.env.SudokuEnv">[docs]</a>
<span class="k">class</span> <span class="nc">SudokuEnv</span><span class="p">(</span><span class="n">ta</span><span class="o">.</span><span class="n">Env</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Sudoku Game Environment</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> 
        <span class="n">difficulty</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;easy&quot;</span><span class="p">,</span>
        <span class="n">max_turns</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialise the Sudoku Environment.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            difficulty (str): The difficulty level of the game (easy, medium, hard).</span>
<span class="sd">            max_turns (int): The maximum number of moves allowed.</span>
<span class="sd">            time_limit (int): The time limit for the game.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">environment_name</span> <span class="o">=</span> <span class="s2">&quot;Sudoku&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">difficulty</span> <span class="o">=</span> <span class="n">difficulty</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_turns</span> <span class="o">=</span> <span class="n">max_turns</span>

        <span class="c1">## initialise the game state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">ta</span><span class="o">.</span><span class="n">State</span><span class="p">(</span>
            <span class="n">num_players</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
            <span class="n">max_turns</span><span class="o">=</span><span class="n">max_turns</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">offline_renderer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">pass</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">terminal_render_keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;rendered_board&quot;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_generate_board</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">difficulty</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a Sudoku puzzle based on the difficulty level.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            difficulty (str): The difficulty level of the game (easy, medium, hard).</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            List[List[int]]: The Sudoku puzzle grid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">## define the number of clues based on difficulty</span>
        <span class="n">difficulty_levels</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;easy&quot;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span> <span class="c1"># 51 clues</span>
            <span class="s2">&quot;medium&quot;</span><span class="p">:</span> <span class="mi">40</span><span class="p">,</span> <span class="c1"># 41 clues</span>
            <span class="s2">&quot;hard&quot;</span><span class="p">:</span> <span class="mi">50</span> <span class="c1"># 31 clues</span>
        <span class="p">}</span>
        <span class="n">clues</span> <span class="o">=</span> <span class="n">difficulty_levels</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">difficulty</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span> <span class="c1"># default to easy</span>

        <span class="c1">## generate a full grid</span>
        <span class="n">full_grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_full_grid</span><span class="p">()</span>

        <span class="c1">## remove cells to create puzzle</span>
        <span class="n">puzzle_grid</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_remove_cells</span><span class="p">(</span><span class="n">full_grid</span><span class="p">,</span> <span class="n">clues</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">puzzle_grid</span>
    
    <span class="k">def</span> <span class="nf">_generate_full_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a fully solvable Sudiku grid using backtracking.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            List[List[int]]: The Sudoku grid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">)]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_fill_grid</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">grid</span>

    <span class="k">def</span> <span class="nf">_fill_grid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grid</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Recursively fills the Sudoku grid using backtracking.</span>

<span class="sd">        Args:</span>
<span class="sd">            grid (List[List[int]]): The Sudoku grid to fill.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if the grid is successfully filled, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">empty</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_empty</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">empty</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>  <span class="c1"># Grid is complete</span>
        <span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">empty</span>

        <span class="n">numbers</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
        <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">numbers</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">numbers</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_safe</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
                <span class="n">grid</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">num</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_fill_grid</span><span class="p">(</span><span class="n">grid</span><span class="p">):</span>
                    <span class="k">return</span> <span class="kc">True</span>
                <span class="n">grid</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="kc">False</span>
    
    <span class="k">def</span> <span class="nf">_find_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grid</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Finds an empty cell in the grid.</span>

<span class="sd">        Args:</span>
<span class="sd">            grid (List[List[int]]): The Sudoku grid.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Optional[Tuple[int, int]]: The row and column of an empty cell, or None if full.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">grid</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">return</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

<div class="viewcode-block" id="SudokuEnv.is_safe">
<a class="viewcode-back" href="../../../../../source/textarena.envs.single_player.Sudoku.html#textarena.envs.single_player.Sudoku.env.SudokuEnv.is_safe">[docs]</a>
    <span class="k">def</span> <span class="nf">is_safe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grid</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]],</span> <span class="n">row</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">col</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">num</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if it&#39;s safe to place a number in a given cell.</span>

<span class="sd">        Args:</span>
<span class="sd">            grid (List[List[int]]): The Sudoku grid.</span>
<span class="sd">            row (int): Row index.</span>
<span class="sd">            col (int): Column index.</span>
<span class="sd">            num (int): Number to place.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if safe, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check row</span>
        <span class="k">if</span> <span class="n">num</span> <span class="ow">in</span> <span class="n">grid</span><span class="p">[</span><span class="n">row</span><span class="p">]:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="c1"># Check column</span>
        <span class="k">if</span> <span class="n">num</span> <span class="ow">in</span> <span class="p">[</span><span class="n">grid</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">col</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">)]:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="c1"># Check subgrid</span>
        <span class="n">start_row</span><span class="p">,</span> <span class="n">start_col</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="n">row</span> <span class="o">//</span> <span class="mi">3</span><span class="p">),</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="n">col</span> <span class="o">//</span> <span class="mi">3</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_row</span><span class="p">,</span> <span class="n">start_row</span> <span class="o">+</span> <span class="mi">3</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_col</span><span class="p">,</span> <span class="n">start_col</span> <span class="o">+</span> <span class="mi">3</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">grid</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">num</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span></div>


    <span class="k">def</span> <span class="nf">_remove_cells</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grid</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]],</span> <span class="n">clues</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Removes cells from the full grid to create a puzzle, ensuring a unique solution.</span>

<span class="sd">        Args:</span>
<span class="sd">            grid (List[List[int]]): A fully solved Sudoku grid.</span>
<span class="sd">            clues (int): Number of clues (filled cells) to retain.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[List[int]]: The resulting Sudoku puzzle grid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">puzzle</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
        <span class="n">cells</span> <span class="o">=</span> <span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">)]</span>
        <span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">cells</span><span class="p">)</span>

        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">cells</span><span class="p">)</span> <span class="o">&gt;</span> <span class="p">(</span><span class="mi">81</span> <span class="o">-</span> <span class="n">clues</span><span class="p">):</span>
            <span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">cells</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
            <span class="n">removed</span> <span class="o">=</span> <span class="n">puzzle</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">col</span><span class="p">]</span>
            <span class="n">puzzle</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="c1"># Make a copy to check for uniqueness</span>
            <span class="n">grid_copy</span> <span class="o">=</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">puzzle</span><span class="p">)</span>
            <span class="n">solutions</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_count_solutions</span><span class="p">(</span><span class="n">grid_copy</span><span class="p">,</span> <span class="n">solutions</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">solutions</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c1"># Not unique, revert the removal</span>
                <span class="n">puzzle</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">removed</span>

        <span class="k">return</span> <span class="n">puzzle</span>

    <span class="k">def</span> <span class="nf">_solve_sudoku</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grid</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Solves the Sudoku puzzle using backtracking. Modifies the grid in-place.</span>

<span class="sd">        Args:</span>
<span class="sd">            grid (List[List[int]]): The Sudoku grid to solve.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if solvable, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">empty</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_empty</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">empty</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>  <span class="c1"># Solved</span>
        <span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">empty</span>

        <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_safe</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
                <span class="n">grid</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">num</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_solve_sudoku</span><span class="p">(</span><span class="n">grid</span><span class="p">):</span>
                    <span class="k">return</span> <span class="kc">True</span>
                <span class="n">grid</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">_count_solutions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">grid</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]],</span> <span class="n">solutions</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]],</span> <span class="n">limit</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Counts the number of solutions for a given Sudoku puzzle.</span>

<span class="sd">        Args:</span>
<span class="sd">            grid (List[List[int]]): The Sudoku grid.</span>
<span class="sd">            solutions (List[List[List[int]]]): A list to store found solutions.</span>
<span class="sd">            limit (int): The maximum number of solutions to find.</span>

<span class="sd">        Returns:</span>
<span class="sd">            int: The number of solutions found.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">solutions</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">limit</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">solutions</span><span class="p">)</span>

        <span class="n">empty</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_empty</span><span class="p">(</span><span class="n">grid</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">empty</span><span class="p">:</span>
            <span class="n">solutions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">grid</span><span class="p">))</span>
            <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">solutions</span><span class="p">)</span>
        <span class="n">row</span><span class="p">,</span> <span class="n">col</span> <span class="o">=</span> <span class="n">empty</span>

        <span class="k">for</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_safe</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
                <span class="n">grid</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">num</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_count_solutions</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">solutions</span><span class="p">,</span> <span class="n">limit</span><span class="p">)</span>
                <span class="n">grid</span><span class="p">[</span><span class="n">row</span><span class="p">][</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">solutions</span><span class="p">)</span>
    
<div class="viewcode-block" id="SudokuEnv.reset">
<a class="viewcode-back" href="../../../../../source/textarena.envs.single_player.Sudoku.html#textarena.envs.single_player.Sudoku.env.SudokuEnv.reset">[docs]</a>
    <span class="k">def</span> <span class="nf">reset</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> 
        <span class="n">seed</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span> 
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ta</span><span class="o">.</span><span class="n">Observations</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reset the game environment.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            seed (int): The random seed for the game.</span>
<span class="sd">            </span>
<span class="sd">        Returns:</span>
<span class="sd">            Tuple containing:</span>
<span class="sd">                - observations (Optional[Dict[int, str]]): Initial observations for the player.</span>
<span class="sd">                - info (Dict[str, Any]): Additional information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">seed</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">()</span>

        <span class="c1">## load the puzzle</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">game_board</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_board</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">difficulty</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">reset</span><span class="p">(</span>
            <span class="n">game_state</span><span class="o">=</span><span class="p">{</span>
                <span class="s2">&quot;board&quot;</span><span class="p">:</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">game_board</span><span class="p">),</span>
                <span class="s2">&quot;rendered_board&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_grid_string_with_indices</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">game_board</span><span class="p">),</span>
                <span class="s2">&quot;start_time&quot;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span>
                <span class="s2">&quot;completed&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">player_prompt_function</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_generate_player_prompt</span><span class="p">,</span>
        <span class="p">)</span></div>

    
    <span class="k">def</span> <span class="nf">_generate_player_prompt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">player_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">game_state</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate the initial prompt for the player, providing them with the Sudoku grid and instructions.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Initial prompt for the player.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">prompt</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;You are Player </span><span class="si">{</span><span class="n">player_id</span><span class="si">}</span><span class="s2">. You are playing Sudoku (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">difficulty</span><span class="si">}</span><span class="s2">).</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;Here is the current state of the Sudoku grid. Each row is numbered from 1 to 9, and each column is also numbered from 1 to 9.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;Empty cells are represented by &#39;.&#39;, and pre-filled cells contain digits from 1 to 9.</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;Current Sudoku Grid:</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        
        <span class="c1"># Include the grid with row and column indices for clarity</span>
        <span class="n">grid_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_grid_string_with_indices</span><span class="p">()</span>
        <span class="n">prompt</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">grid_str</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        
        <span class="n">prompt</span> <span class="o">+=</span> <span class="p">(</span>
            <span class="s2">&quot;Your objective is to fill the empty cells in the 9x9 grid with digits from 1 to 9 such that:</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;1. Each row contains all digits from 1 to 9 without repetition.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;2. Each column contains all digits from 1 to 9 without repetition.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;3. Each of the nine 3x3 subgrids contains all digits from 1 to 9 without repetition.</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;Rules and Instructions:</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;1. **Do not overwrite** the initial numbers provided in the grid.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;2. **Only fill** empty cells represented by &#39;.&#39;.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;3. You may respond in any manner you prefer, but ensure that your response includes the format of &#39;[row column number]&#39;.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;4. **Ensure** that your move does not violate Sudoku rules. Invalid moves will result in penalties.</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;Examples:</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;- **Valid Move**:</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;  - Grid Snippet Before Move:</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;  </span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;  - Move: `[5 3 7]`</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;  - Explanation: Placing 7 at row 5, column 3 does not violate any Sudoku rules.</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;- **Invalid Move** (Overwriting a pre-filled cell):</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;  - Grid Snippet Before Move:</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;  </span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;  - Move: `[1 1 9]`</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;  - Explanation: Cell (1,1) is already filled with 5. You cannot overwrite it.</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;- **Invalid Move** (Violating Sudoku rules):</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;  - Grid Snippet Before Move:</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;  </span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;  - Move: `[1 3 5]`</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;  - Explanation: Placing 5 in row 1, column 3 violates the rule since 5 already exists in row 1.</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;The history of your moves and thoughts will be appended as you play more rounds. Use the history of your move to improve your decision making by avoiding the moves you have tried. Good luck!</span><span class="se">\n\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>
        
        <span class="k">return</span> <span class="n">prompt</span>


<div class="viewcode-block" id="SudokuEnv.step">
<a class="viewcode-back" href="../../../../../source/textarena.envs.single_player.Sudoku.html#textarena.envs.single_player.Sudoku.env.SudokuEnv.step">[docs]</a>
    <span class="k">def</span> <span class="nf">step</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> 
        <span class="n">action</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span>
        <span class="n">Optional</span><span class="p">[</span><span class="n">ta</span><span class="o">.</span><span class="n">Observations</span><span class="p">],</span> <span class="c1"># observations</span>
        <span class="n">Optional</span><span class="p">[</span><span class="n">ta</span><span class="o">.</span><span class="n">Rewards</span><span class="p">],</span> <span class="c1"># reward</span>
        <span class="nb">bool</span><span class="p">,</span> <span class="c1"># truncated</span>
        <span class="nb">bool</span><span class="p">,</span> <span class="c1"># terminated</span>
        <span class="n">ta</span><span class="o">.</span><span class="n">Info</span> <span class="c1"># info</span>
    <span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Take a step in the game environment given an action from a player.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            player_id (int): The ID of the player taking the action.</span>
<span class="sd">            action (str): The action taken by the player.</span>

<span class="sd">        Returns:</span>
<span class="sd">            - observations (Optional[Dict[int, str]]): Observations for the player after the action.</span>
<span class="sd">            - rewards (Optional[Dict[int, float]]): Rewards for the player after the action.</span>
<span class="sd">            - truncated (bool): Whether the episode has been truncated.</span>
<span class="sd">            - terminated (bool): Whether the episode has ended.</span>
<span class="sd">            - info (Dict[str, Any]): Additional information.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">player_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">current_player_id</span>
        
        <span class="c1">## update the observations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">add_observation</span><span class="p">(</span>
            <span class="n">from_id</span><span class="o">=</span><span class="n">player_id</span><span class="p">,</span>
            <span class="n">to_id</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="c1"># this means send observation to all players (presumably, all players can see the board)</span>
            <span class="n">message</span><span class="o">=</span><span class="n">action</span><span class="p">,</span>
            <span class="n">for_logging</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="c1">## validate the actions</span>
        <span class="c1">## extract the format [row column number] from the action</span>
        <span class="n">action_search_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\[(\d+)\s(\d+)\s(\d+)\]&quot;</span><span class="p">)</span>
        <span class="n">match</span> <span class="o">=</span> <span class="n">action_search_pattern</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">set_invalid_move</span><span class="p">(</span>
                <span class="n">player_ids</span><span class="o">=</span><span class="p">[</span><span class="n">player_id</span><span class="p">],</span>
                <span class="n">reasons</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Invalid move format. Player </span><span class="si">{</span><span class="n">player_id</span><span class="si">}</span><span class="s2"> did not respond with valid &#39;row column number&#39;.&quot;</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">num</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">row</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">row</span> <span class="o">&gt;</span> <span class="mi">9</span> <span class="ow">or</span> <span class="n">col</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">col</span> <span class="o">&gt;</span> <span class="mi">9</span> <span class="ow">or</span> <span class="n">num</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">num</span> <span class="o">&gt;</span> <span class="mi">9</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">set_invalid_move</span><span class="p">(</span>
                    <span class="n">player_ids</span><span class="o">=</span><span class="p">[</span><span class="n">player_id</span><span class="p">],</span>
                    <span class="n">reasons</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Invalid move. Player </span><span class="si">{</span><span class="n">player_id</span><span class="si">}</span><span class="s2"> attempted to place </span><span class="si">{</span><span class="n">num</span><span class="si">}</span><span class="s2"> at (</span><span class="si">{</span><span class="n">row</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">), which is out of bounds.&quot;</span><span class="p">]</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">row_idx</span><span class="p">,</span> <span class="n">col_idx</span> <span class="o">=</span> <span class="n">row</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">col</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="c1">## check if the cell is already filled in the initial grid</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">game_board</span><span class="p">[</span><span class="n">row_idx</span><span class="p">][</span><span class="n">col_idx</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">set_invalid_move</span><span class="p">(</span>
                        <span class="n">player_ids</span><span class="o">=</span><span class="p">[</span><span class="n">player_id</span><span class="p">],</span>
                        <span class="n">reasons</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Invalid move. Player </span><span class="si">{</span><span class="n">player_id</span><span class="si">}</span><span class="s2"> attempted to overwrite a pre-filled cell (</span><span class="si">{</span><span class="n">row</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">).&quot;</span><span class="p">]</span>
                    <span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_move_correct</span><span class="p">(</span><span class="n">row_idx</span><span class="p">,</span> <span class="n">col_idx</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
                    <span class="c1">## update the grid</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">game_state</span><span class="p">[</span><span class="s2">&quot;board&quot;</span><span class="p">][</span><span class="n">row_idx</span><span class="p">][</span><span class="n">col_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">num</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">add_observation</span><span class="p">(</span>
                        <span class="n">from_id</span><span class="o">=</span><span class="n">ta</span><span class="o">.</span><span class="n">GAME_ID</span><span class="p">,</span>
                        <span class="n">to_id</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
                        <span class="n">message</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Board state: </span><span class="se">\n</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_grid_string_with_indices</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="n">for_logging</span><span class="o">=</span><span class="kc">False</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">set_invalid_move</span><span class="p">(</span>
                        <span class="n">player_ids</span><span class="o">=</span><span class="p">[</span><span class="n">player_id</span><span class="p">],</span>
                        <span class="n">reasons</span><span class="o">=</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;Invalid move. Player </span><span class="si">{</span><span class="n">player_id</span><span class="si">}</span><span class="s2"> attempted to place </span><span class="si">{</span><span class="n">num</span><span class="si">}</span><span class="s2"> at (</span><span class="si">{</span><span class="n">row</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s2">), which violates Sudoku rules.&quot;</span><span class="p">]</span>
                    <span class="p">)</span>

                <span class="c1">## check if the game is completed</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_puzzle_complete</span><span class="p">():</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">game_state</span><span class="p">[</span><span class="s2">&quot;completed&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">set_winners</span><span class="p">(</span>
                        <span class="n">player_ids</span><span class="o">=</span><span class="p">[</span><span class="n">player_id</span><span class="p">],</span>
                        <span class="n">reason</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Congratulations! Player </span><span class="si">{</span><span class="n">player_id</span><span class="si">}</span><span class="s2"> completed the Sudoku puzzle.&quot;</span>
                    <span class="p">)</span>

                <span class="c1">## update game board</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">game_state</span><span class="p">[</span><span class="s2">&quot;rendered_board&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_grid_string_with_indices</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">game_state</span><span class="p">[</span><span class="s2">&quot;board&quot;</span><span class="p">])</span>

        <span class="c1">## step the state</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">step</span><span class="p">()</span></div>

            
<div class="viewcode-block" id="SudokuEnv.render">
<a class="viewcode-back" href="../../../../../source/textarena.envs.single_player.Sudoku.html#textarena.envs.single_player.Sudoku.env.SudokuEnv.render">[docs]</a>
    <span class="k">def</span> <span class="nf">render</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Renders the current state of the Sudoku grid.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: The rendered game state.</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">grid_str</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_grid_string_with_indices</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Board State</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">grid_str</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Turn Number </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">turn</span><span class="si">}</span><span class="s2"> of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">max_turns</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

    
    <span class="k">def</span> <span class="nf">_get_grid_string_with_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">game_board</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts the current grid to a formatted string with row and column indices.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: Formatted grid string with indices.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">game_board</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">game_board</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">game_state</span><span class="p">[</span><span class="s2">&quot;board&quot;</span><span class="p">]</span>
        <span class="n">header</span> <span class="o">=</span> <span class="s2">&quot;   &quot;</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;C</span><span class="si">{</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="p">(</span><span class="s2">&quot;  &quot;</span> <span class="k">if</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">)])</span>  <span class="c1"># Column headers</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">header</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">game_board</span><span class="p">):</span>
            <span class="n">row_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;R</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> &quot;</span>  <span class="c1"># Row header</span>
            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
                <span class="n">cell</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">)</span> <span class="k">if</span> <span class="n">num</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="s2">&quot;.&quot;</span>
                <span class="n">row_str</span> <span class="o">+=</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">cell</span><span class="si">}</span><span class="s2"> &quot;</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">:</span>
                    <span class="n">row_str</span> <span class="o">+=</span> <span class="s2">&quot;| &quot;</span>
            <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row_str</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="mi">3</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">:</span>
                <span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;   &quot;</span> <span class="o">+</span> <span class="s2">&quot;- &quot;</span> <span class="o">*</span> <span class="mi">16</span><span class="p">)</span>

        <span class="k">return</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">_is_move_correct</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">col</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">num</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if placing a number at the given position is correct.</span>

<span class="sd">        Args:</span>
<span class="sd">            row (int): Row index (0-based).</span>
<span class="sd">            col (int): Column index (0-based).</span>
<span class="sd">            num (int): Number to place.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if the move is correct, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Check row</span>
        <span class="k">if</span> <span class="n">num</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">game_state</span><span class="p">[</span><span class="s2">&quot;board&quot;</span><span class="p">][</span><span class="n">row</span><span class="p">]:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="c1"># Check column</span>
        <span class="k">if</span> <span class="n">num</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">game_state</span><span class="p">[</span><span class="s2">&quot;board&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">col</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">)]:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="c1"># Check 3x3 subgrid</span>
        <span class="n">start_row</span><span class="p">,</span> <span class="n">start_col</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="n">row</span> <span class="o">//</span> <span class="mi">3</span><span class="p">),</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="n">col</span> <span class="o">//</span> <span class="mi">3</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_row</span><span class="p">,</span> <span class="n">start_row</span> <span class="o">+</span> <span class="mi">3</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">start_col</span><span class="p">,</span> <span class="n">start_col</span> <span class="o">+</span> <span class="mi">3</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">game_state</span><span class="p">[</span><span class="s2">&quot;board&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">num</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>
    
    <span class="k">def</span> <span class="nf">_is_puzzle_complete</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if the puzzle is completely and correctly filled.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if complete, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">9</span><span class="p">):</span>
                <span class="n">num</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">game_state</span><span class="p">[</span><span class="s2">&quot;board&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">num</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_move_correct_complete</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
                    <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>
    
    <span class="k">def</span> <span class="nf">_is_move_correct_complete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">row</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">col</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">num</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if the current move is still valid in the completed puzzle.</span>

<span class="sd">        Args:</span>
<span class="sd">            row (int): Row index (0-based).</span>
<span class="sd">            col (int): Column index (0-based).</span>
<span class="sd">            num (int): Number to place.</span>

<span class="sd">        Returns:</span>
<span class="sd">            bool: True if the move is correct, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Temporarily remove the number to check for duplicates</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">game_state</span><span class="p">[</span><span class="s2">&quot;board&quot;</span><span class="p">][</span><span class="n">row</span><span class="p">][</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">correct</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_move_correct</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span><span class="o">.</span><span class="n">game_state</span><span class="p">[</span><span class="s2">&quot;board&quot;</span><span class="p">][</span><span class="n">row</span><span class="p">][</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">num</span>
        <span class="k">return</span> <span class="n">correct</span></div>

</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../../../index.html">TextArena</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../../source/modules.html">textarena</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../../../../index.html">Documentation overview</a><ul>
  <li><a href="../../../../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2025, Leon Guertler, Bobby Cheng.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.1.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
    </div>

    

    
  </body>
</html>